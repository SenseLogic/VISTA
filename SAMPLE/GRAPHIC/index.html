<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <title>Sample</title>
        <style>
        </style>
    </head>
    <body>
        <main>
            <canvas id="colored-triangle-canvas" width="640" height="480">
            </canvas>
            <canvas id="textured-cube-canvas" width="640" height="480">
            </canvas>
        </main>
        <script src="../../CODE/JAVASCRIPT/vista_base.js"></script>>
        <script src="../../CODE/JAVASCRIPT/vista_math.js"></script>
        <script src="../../CODE/JAVASCRIPT/vista_vector_3.js"></script>
        <script src="../../CODE/JAVASCRIPT/vista_matrix_4.js"></script>
        <script src="../../CODE/JAVASCRIPT/vista_element.js"></script>
        <script src="../../CODE/JAVASCRIPT/vista_graphic.js"></script>
        <script id="colored-triangle-vertex-shader" type="x-shader/x-vertex">
            attribute vec4 VertexPositionAttribute;
            attribute vec4 VertexColorAttribute;
            varying vec4 VertexColorVarying;

            void main(
                )
            {
                gl_Position = VertexPositionAttribute;
                VertexColorVarying = VertexColorAttribute;
            }
        </script>
        <script id="colored-triangle-fragment-shader" type="x-shader/x-fragment">
            precision mediump float;
            varying vec4 VertexColorVarying;

            void main(
                )
            {
                gl_FragColor = VertexColorVarying;
            }
        </script>
        <script id="textured-cube-vertex-shader" type="x-shader/x-vertex">
            attribute vec4 VertexPositionAttribute;
            attribute vec2 VertexMappingAttribute;
            uniform mat4 ModelViewMatrixUniform;
            uniform mat4 ProjectionMatrixUniform;
            varying highp vec2 VertexMappingVarying;

            void main(
                )
            {
                gl_Position = ProjectionMatrixUniform * ModelViewMatrixUniform * VertexPositionAttribute;
                VertexMappingVarying = VertexMappingAttribute;
            }
        </script>
        <script id="textured-cube-fragment-shader" type="x-shader/x-fragment">
            precision mediump float;
            varying highp vec2 VertexMappingVarying;
            uniform sampler2D TextureSamplerUniform;

            void main(
                )
            {
                gl_FragColor = texture2D( TextureSamplerUniform, VertexMappingVarying );
            }
        </script>
        <script>
            // -- FUNCTIONS

            async function RenderColoredTriangle(
                )
            {
                var
                    canvas,
                    vertex_color_attribute,
                    fragment_shader,
                    vertex_position_attribute,
                    program,
                    vertex_position_color_array_buffer,
                    vertex_shader;

                canvas = new GRAPHIC_CANVAS( GetElementById( "colored-triangle-canvas" ) );

                vertex_shader
                    = canvas.CreateVertexShader(
                          "colored-triangle-vertex-shader",
                          GetElementById( "colored-triangle-vertex-shader" ).text
                          );

                fragment_shader
                    = canvas.CreateFragmentShader(
                          "colored-triangle-fragment-shader",
                          GetElementById( "colored-triangle-fragment-shader" ).text
                          );

                program = canvas.CreateProgram( vertex_shader, fragment_shader );
                program.Use();

                vertex_position_color_array_buffer
                    = canvas.CreateReal32ArrayBuffer(
                          [
                              0.0, 0.5, 1.0, 0.0, 0.0,
                              -0.5, -0.5, 0.0, 1.0, 0.0,
                              0.5, -0.5, 0.0, 0.0, 1.0
                          ]
                          );

                vertex_position_attribute = program.GetAttribute( "VertexPositionAttribute" );
                vertex_position_attribute.SetReal32ArrayBuffer( vertex_position_color_array_buffer, 2, 5, 0 );

                vertex_color_attribute = program.GetAttribute( "VertexColorAttribute" );
                vertex_color_attribute.SetReal32ArrayBuffer( vertex_position_color_array_buffer, 3, 5, 2 );

                canvas.Clear( [ 0.9, 0.9, 0.9, 1.0 ] );
                canvas.DrawTriangles( 0, 3 );
            }

            // ~~

            async function RenderTexturedCube(
                )
            {
                var
                    canvas,
                    element_array_buffer,
                    fragment_shader,
                    model_view_matrix,
                    perspective_matrix,
                    program,
                    texture,
                    vertex_mapping_array_buffer,
                    vertex_mapping_attribute,
                    vertex_position_array_buffer,
                    vertex_position_attribute,
                    vertex_shader;

                canvas = new GRAPHIC_CANVAS( GetElementById( "textured-cube-canvas" ) );
                texture = canvas.CreateTexture();
                await texture.LoadImage( "texture_1.png" );

                vertex_shader
                    = canvas.CreateVertexShader(
                          "textured-cube-vertex-shader",
                          GetElementById( "textured-cube-vertex-shader" ).text
                          );

                fragment_shader
                    = canvas.CreateFragmentShader(
                          "textured-cube-fragment-shader",
                          GetElementById( "textured-cube-fragment-shader" ).text
                          );

                program = canvas.CreateProgram( vertex_shader, fragment_shader );
                program.VertexPositionAttribute = program.GetAttribute( "VertexPositionAttribute" );
                program.VertexMappingAttribute = program.GetAttribute( "VertexMappingAttribute" );
                program.TextureSamplerUniform = program.GetUniform( "TextureSamplerUniform" );
                program.ModelViewMatrixUniform = program.GetUniform( "ModelViewMatrixUniform" );
                program.ProjectionMatrixUniform = program.GetUniform( "ProjectionMatrixUniform" );

                vertex_position_array_buffer
                    = canvas.CreateReal32ArrayBuffer(
                          [
                              -1.0, -1.0, 1.0, 1.0, -1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0, 1.0,
                              -1.0, -1.0, -1.0, -1.0, 1.0, -1.0, 1.0, 1.0, -1.0, 1.0, -1.0, -1.0,
                              -1.0, 1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0,
                              -1.0, -1.0, -1.0, 1.0, -1.0, -1.0, 1.0, -1.0, 1.0, -1.0, -1.0, 1.0,
                              1.0, -1.0, -1.0, 1.0, 1.0, -1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0,
                              -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, -1.0, 1.0, 1.0, -1.0, 1.0, -1.0
                          ]
                          );

                vertex_mapping_array_buffer
                    = canvas.CreateReal32ArrayBuffer(
                          [
                              0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0,
                              0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0,
                              0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0,
                              0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0,
                              0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0,
                              0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0
                          ]
                          );

                element_array_buffer
                    = canvas.CreateNatural16ElementArrayBuffer(
                          [
                              0, 1, 2, 0, 2, 3,
                              4, 5, 6, 4, 6, 7,
                              8, 9, 10, 8, 10, 11,
                              12, 13, 14, 12, 14, 15,
                              16, 17, 18, 16, 18, 19,
                              20, 21, 22, 20, 22, 23
                          ]
                          );

                model_view_matrix = GetTranslationMatrix4( GetVector3( 0.0, 0.0, -7.0 ) );
                projection_matrix = GetPerspectiveMatrix4( 45.0 * DegreeRadians, 45.0 * DegreeRadians, 0.1, 100.0 );

                program.Use();
                program.VertexPositionAttribute.SetReal32ArrayBuffer( vertex_position_array_buffer, 3 );
                program.VertexMappingAttribute.SetReal32ArrayBuffer( vertex_mapping_array_buffer, 2 );
                program.TextureSamplerUniform.BindTexture( texture, 0 );
                program.ModelViewMatrixUniform.SetRealMatrix4( model_view_matrix );
                program.ProjectionMatrixUniform.SetRealMatrix4( projection_matrix );

                canvas.Clear( [ 0.9, 0.9, 0.9, 1.0 ] );
                canvas.DrawIndexedTriangles( 12, 0, 3 );
            }

            // -- STATEMENTS

            RenderColoredTriangle();
            RenderTexturedCube();
        </script>
    </body>
</html>
